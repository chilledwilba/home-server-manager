version: '3.8'

services:
  home-server-monitor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: home-server-monitor
    restart: unless-stopped
    ports:
      - '3100:3100'
    environment:
      - NODE_ENV=production
      - PORT=3100
      - HOST=0.0.0.0
      - TRUENAS_HOST=${TRUENAS_HOST}
      - TRUENAS_API_KEY=${TRUENAS_API_KEY}
      - PORTAINER_HOST=${PORTAINER_HOST}
      - PORTAINER_PORT=${PORTAINER_PORT:-9000}
      - PORTAINER_TOKEN=${PORTAINER_TOKEN}
      - ENABLE_WRITE_OPERATIONS=${ENABLE_WRITE_OPERATIONS:-false}
      - REQUIRE_CONFIRMATION=${REQUIRE_CONFIRMATION:-true}
    volumes:
      - ./data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - monitoring
    healthcheck:
      test: ['CMD', 'wget', '--no-verbose', '--tries=1', '--spider', 'http://localhost:3100/health']
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  monitoring:
    driver: bridge
